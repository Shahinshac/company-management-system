<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Change Password</title>
<style>body{font-family:Segoe UI,Arial;background:#f5f7fb;padding:20px} .container{max-width:420px;margin:50px auto;background:#fff;padding:24px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.08)} h1{color:#333} .form-group{margin-bottom:16px} input{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px} .btn{background:#667eea;color:#fff;padding:10px 14px;border:none;border-radius:6px;cursor:pointer}</style>
</head>
<body>
<div class="container">
  <h1>Change Password</h1>
  <p>Please enter a new password (minimum 6 characters).</p>
  <div id="alert" style="display:none;padding:10px;margin-bottom:12px;border-radius:6px"></div>
  <div class="form-group">
    <label>New Password</label>
    <input id="newPassword" type="password" />
  </div>
  <div class="form-group">
    <label>Confirm Password</label>
    <input id="confirmPassword" type="password" />
  </div>
  <button class="btn" id="changeBtn">Change Password</button>
</div>
<script>
const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api';
function showAlert(msg, type='error'){
  const el = document.getElementById('alert'); el.style.display='block'; el.style.background= type==='success'? '#d4edda': (type==='warning'? '#fff3cd': '#f8d7da'); el.style.color= type==='success'? '#155724': (type==='warning'? '#856404': '#721c24'); el.textContent=msg;
}

document.getElementById('changeBtn').addEventListener('click', async ()=>{
  const p = document.getElementById('newPassword').value;
  const cp = document.getElementById('confirmPassword').value;
  if (!p || p.length<6){ showAlert('Password must be 6 or more characters'); return; }
  if (p!==cp){ showAlert('Passwords do not match'); return; }
  const token = localStorage.getItem('token'); if(!token){ showAlert('Not authenticated'); setTimeout(()=>location.href='login.html',1000); return; }
  try{
    const res = await fetch(`${API_URL}/auth/change-password`, { method:'PATCH', headers:{ 'Content-Type':'application/json','Authorization':`Bearer ${token}` }, body: JSON.stringify({ newPassword: p }) });
    const data = await res.json();
    if (res.ok){ showAlert('Password changed successfully','success'); setTimeout(()=>{ localStorage.removeItem('token'); localStorage.removeItem('user'); location.href='login.html'; },1500); }
    else showAlert(data.error||'Failed to change password');
  }catch(err){ showAlert('Connection error'); }
});
</script>
</body>
</html>